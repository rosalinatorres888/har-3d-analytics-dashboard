<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MotionInsight: Technical Deep Dive</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            overflow-x: hidden;
        }

        .tech-header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            padding: 30px;
            text-align: center;
            border-bottom: 3px solid #3498db;
        }

        .tech-header h1 {
            font-size: 2.5rem;
            color: #3498db;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .tech-header p {
            font-size: 1.1rem;
            color: #bdc3c7;
        }

        .control-panel {
            background: #2c3e50;
            padding: 20px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            border-bottom: 1px solid #34495e;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .control-group label {
            color: #bdc3c7;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .control-group select, .control-group input {
            padding: 8px 12px;
            border: 2px solid #34495e;
            border-radius: 5px;
            background: #1a1a1a;
            color: #e0e0e0;
            font-size: 0.9rem;
        }

        .control-group select:focus, .control-group input:focus {
            outline: none;
            border-color: #3498db;
        }

        .dashboard-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 500px 400px 350px;
            gap: 20px;
            padding: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .viz-container {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 1px solid #34495e;
            position: relative;
            overflow: hidden;
        }

        .viz-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3498db, #2ecc71, #e74c3c, #f39c12);
        }

        .viz-container.full-width {
            grid-column: 1 / -1;
        }

        .viz-title {
            color: #3498db;
            font-size: 1.2rem;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
        }

        .stats-overlay {
            position: absolute;
            top: 60px;
            right: 20px;
            background: rgba(52, 73, 94, 0.9);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
            min-width: 200px;
            z-index: 10;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 0.9rem;
        }

        .stat-value {
            color: #2ecc71;
            font-weight: bold;
        }

        .methodology-panel {
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
            grid-column: 1 / -1;
            padding: 30px;
            border-radius: 15px;
            margin: 20px;
            box-shadow: 0 15px 35px rgba(142, 68, 173, 0.3);
        }

        .methodology-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .method-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .method-box h3 {
            color: #ecf0f1;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .method-box p {
            color: #bdc3c7;
            line-height: 1.6;
        }

        .formula {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            border-left: 4px solid #e74c3c;
        }

        .code-snippet {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            border-left: 4px solid #2ecc71;
            font-size: 0.9rem;
            color: #2ecc71;
        }

        @media (max-width: 1200px) {
            .dashboard-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
            }
            
            .control-panel {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="tech-header">
        <h1>MotionInsight: Technical Deep Dive</h1>
        <p>Advanced Entropy Analysis for Human Activity Recognition</p>
    </div>

    <div class="control-panel">
        <div class="control-group">
            <label>Activity Filter</label>
            <select id="activity-filter">
                <option value="all">All Activities</option>
                <option value="walking">Walking</option>
                <option value="running">Running</option>
                <option value="climbing_up">Climbing Up</option>
                <option value="climbing_down">Climbing Down</option>
            </select>
        </div>
        <div class="control-group">
            <label>Embedding Dimension</label>
            <input type="range" id="embedding-dim" min="3" max="7" value="5" step="1">
            <span id="dim-value">5</span>
        </div>
        <div class="control-group">
            <label>Time Delay</label>
            <input type="range" id="time-delay" min="1" max="5" value="2" step="1">
            <span id="delay-value">2</span>
        </div>
        <div class="control-group">
            <label>Visualization Mode</label>
            <select id="viz-mode">
                <option value="entropy">Entropy Analysis</option>
                <option value="complexity">Complexity Analysis</option>
                <option value="combined">Combined View</option>
            </select>
        </div>
    </div>

    <div class="dashboard-container">
        <div class="viz-container">
            <div class="viz-title">3D Entropy-Complexity Space</div>
            <div id="entropy-3d"></div>
            <div class="stats-overlay">
                <div class="stat-item">
                    <span>Samples:</span>
                    <span class="stat-value" id="sample-count">240</span>
                </div>
                <div class="stat-item">
                    <span>F-Statistic:</span>
                    <span class="stat-value" id="f-stat">22.61</span>
                </div>
                <div class="stat-item">
                    <span>P-Value:</span>
                    <span class="stat-value" id="p-value">&lt;0.001</span>
                </div>
                <div class="stat-item">
                    <span>η² Effect:</span>
                    <span class="stat-value" id="effect-size">0.234</span>
                </div>
            </div>
        </div>

        <div class="viz-container">
            <div class="viz-title">Feature Importance Heatmap</div>
            <div id="feature-heatmap"></div>
        </div>

        <div class="viz-container">
            <div class="viz-title">Parameter Optimization Surface</div>
            <div id="parameter-surface"></div>
        </div>

        <div class="viz-container">
            <div class="viz-title">Statistical Validation Results</div>
            <div id="validation-results"></div>
        </div>

        <div class="viz-container full-width">
            <div class="viz-title">Real-Time Activity Classification Pipeline</div>
            <div id="pipeline-flow"></div>
        </div>
    </div>

    <div class="methodology-panel">
        <h2 style="text-align: center; color: #ecf0f1; margin-bottom: 30px;">Advanced Methodology</h2>
        <div class="methodology-content">
            <div class="method-box">
                <h3>Permutation Entropy</h3>
                <p>Measures the temporal complexity of time series by analyzing ordinal patterns.</p>
                <div class="formula">
                    PE = -∑ p(πᵢ) × log(p(πᵢ))
                </div>
                <div class="code-snippet">
def permutation_entropy(signal, m=5, tau=2):
    patterns = ordinal_patterns(signal, m, tau)
    probs = pattern_probabilities(patterns)
    return -sum(p * np.log(p) for p in probs if p > 0)
                </div>
            </div>

            <div class="method-box">
                <h3>Jensen-Shannon Complexity</h3>
                <p>Normalized measure combining entropy with equilibrium distribution distance.</p>
                <div class="formula">
                    C = H[P] × JS[P,Pₑ] / H_max
                </div>
                <div class="code-snippet">
def js_complexity(signal, m=5, tau=2):
    pe = permutation_entropy(signal, m, tau)
    js_div = jensen_shannon_divergence(signal, m, tau)
    return pe * js_div / np.log(np.math.factorial(m))
                </div>
            </div>

            <div class="method-box">
                <h3>Statistical Validation</h3>
                <p>F-test ANOVA with effect size analysis for feature significance testing.</p>
                <div class="formula">
                    F = MS_between / MS_within
                    η² = SS_between / SS_total
                </div>
                <div class="code-snippet">
from scipy.stats import f_oneway
f_stat, p_value = f_oneway(*activity_groups)
eta_squared = ss_between / ss_total
                </div>
            </div>

            <div class="method-box">
                <h3>Vertical Axis Discovery</h3>
                <p>Novel finding: 27.8% of discriminative information comes from vertical processing.</p>
                <div class="formula">
                    Dominance_ratio = ∑F_vertical / ∑F_total
                </div>
                <div class="code-snippet">
vertical_features = ['PE_z', 'Complexity_z', 'Vertical_Dominance']
vertical_importance = sum(f_stats[f] for f in vertical_features)
dominance_ratio = vertical_importance / total_importance
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables for data and state
        let currentData = generateSampleData();
        let currentParams = { embedding: 5, delay: 2, activity: 'all', mode: 'entropy' };

        function generateSampleData() {
            const activities = ['walking', 'running', 'climbing_up', 'climbing_down'];
            const colors = ['#e74c3c', '#3498db', '#2ecc71', '#f39c12'];
            const data = [];

            activities.forEach((activity, actIdx) => {
                for (let i = 0; i < 60; i++) {
                    const baseEntropy = 0.3 + actIdx * 0.15 + Math.random() * 0.2;
                    const baseComplexity = 0.2 + Math.sin(actIdx) * 0.15 + Math.random() * 0.15;
                    
                    data.push({
                        activity: activity,
                        color: colors[actIdx],
                        entropy_x: baseEntropy + Math.random() * 0.1,
                        entropy_y: baseEntropy * 0.7 + Math.random() * 0.2,
                        entropy_z: baseEntropy * 1.3 + Math.random() * 0.15,
                        complexity_x: baseComplexity + Math.random() * 0.08,
                        complexity_y: baseComplexity * 0.8 + Math.random() * 0.1,
                        complexity_z: baseComplexity * 1.2 + Math.random() * 0.1,
                        vertical_dominance: 0.15 + actIdx * 0.08 + Math.random() * 0.1
                    });
                }
            });

            return data;
        }

        function create3DEntropyPlot() {
            const filteredData = currentData.filter(d => 
                currentParams.activity === 'all' || d.activity === currentParams.activity
            );

            const activities = [...new Set(filteredData.map(d => d.activity))];
            const traces = activities.map(activity => {
                const activityData = filteredData.filter(d => d.activity === activity);
                return {
                    x: activityData.map(d => d.entropy_x),
                    y: activityData.map(d => d.entropy_y),
                    z: activityData.map(d => d.entropy_z),
                    mode: 'markers',
                    type: 'scatter3d',
                    name: activity.replace('_', ' ').toUpperCase(),
                    marker: {
                        size: 6,
                        color: activityData[0]?.color || '#3498db',
                        opacity: 0.8,
                        line: { width: 1, color: '#2c3e50' }
                    }
                };
            });

            const layout = {
                scene: {
                    xaxis: { 
                        title: 'PE X-Axis',
                        color: '#bdc3c7',
                        gridcolor: '#34495e'
                    },
                    yaxis: { 
                        title: 'PE Y-Axis',
                        color: '#bdc3c7',
                        gridcolor: '#34495e'
                    },
                    zaxis: { 
                        title: 'PE Z-Axis (Vertical)',
                        color: '#bdc3c7',
                        gridcolor: '#34495e'
                    },
                    bgcolor: 'rgba(0,0,0,0)',
                    camera: {
                        eye: { x: 1.5, y: 1.5, z: 1.2 }
                    }
                },
                margin: { l: 0, r: 0, b: 0, t: 0 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e0e0e0' },
                legend: { 
                    font: { color: '#e0e0e0' },
                    bgcolor: 'rgba(44, 62, 80, 0.8)'
                }
            };

            Plotly.newPlot('entropy-3d', traces, layout, {responsive: true, displayModeBar: false});
        }

        function createFeatureHeatmap() {
            const features = ['PE_x', 'PE_y', 'PE_z', 'Comp_x', 'Comp_y', 'Comp_z', 'Vertical_Dom'];
            const fStats = [11.96, 1706.35, 1619.47, 9.60, 12.00, 18.91, 2803.42];
            
            const trace = {
                z: [fStats],
                x: features,
                y: ['F-Statistic'],
                type: 'heatmap',
                colorscale: [
                    [0, '#2c3e50'],
                    [0.3, '#3498db'],
                    [0.6, '#2ecc71'],
                    [0.8, '#f39c12'],
                    [1, '#e74c3c']
                ],
                text: fStats.map(f => f.toFixed(2)),
                texttemplate: '%{text}',
                textfont: { color: 'white', size: 12 },
                showscale: true,
                colorbar: {
                    title: 'F-Statistic',
                    titlefont: { color: '#e0e0e0' },
                    tickfont: { color: '#e0e0e0' }
                }
            };

            const layout = {
                xaxis: { 
                    color: '#e0e0e0',
                    tickangle: -45
                },
                yaxis: { 
                    color: '#e0e0e0'
                },
                margin: { l: 80, r: 50, b: 80, t: 20 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };

            Plotly.newPlot('feature-heatmap', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createParameterSurface() {
            const dimensions = [3, 4, 5, 6, 7];
            const delays = [1, 2, 3, 4, 5];
            const z = dimensions.map(dim => 
                delays.map(delay => {
                    // Simulate F-statistic optimization surface
                    const optimal_dim = 5;
                    const optimal_delay = 2;
                    const base = 20;
                    const dim_penalty = Math.abs(dim - optimal_dim) * 2;
                    const delay_penalty = Math.abs(delay - optimal_delay) * 1.5;
                    return base - dim_penalty - delay_penalty + Math.random() * 3;
                })
            );

            const trace = {
                z: z,
                x: delays,
                y: dimensions,
                type: 'surface',
                colorscale: 'Viridis',
                contours: {
                    z: {
                        show: true,
                        usecolormap: true,
                        highlightcolor: "#42f462",
                        project: { z: true }
                    }
                },
                colorbar: {
                    title: 'F-Statistic',
                    titlefont: { color: '#e0e0e0' },
                    tickfont: { color: '#e0e0e0' }
                }
            };

            const layout = {
                scene: {
                    xaxis: { 
                        title: 'Time Delay',
                        color: '#bdc3c7'
                    },
                    yaxis: { 
                        title: 'Embedding Dimension',
                        color: '#bdc3c7'
                    },
                    zaxis: { 
                        title: 'F-Statistic',
                        color: '#bdc3c7'
                    },
                    bgcolor: 'rgba(0,0,0,0)',
                    camera: {
                        eye: { x: 1.8, y: 1.8, z: 1.2 }
                    }
                },
                margin: { l: 0, r: 0, b: 0, t: 0 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };

            Plotly.newPlot('parameter-surface', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createValidationResults() {
            const tests = ['ANOVA', 'Cross-Validation', 'Bootstrap', 'Permutation'];
            const pValues = [0.001, 0.003, 0.002, 0.001];
            const colors = pValues.map(p => p < 0.001 ? '#2ecc71' : p < 0.01 ? '#f39c12' : '#e74c3c');

            const trace = {
                x: tests,
                y: pValues.map(p => -Math.log10(p)),
                type: 'bar',
                marker: {
                    color: colors,
                    line: { color: '#2c3e50', width: 2 }
                },
                text: pValues.map(p => `p=${p.toFixed(3)}`),
                textposition: 'auto',
                textfont: { color: 'white' }
            };

            const layout = {
                yaxis: { 
                    title: '-log₁₀(p-value)',
                    color: '#e0e0e0'
                },
                xaxis: { 
                    color: '#e0e0e0'
                },
                shapes: [{
                    type: 'line',
                    x0: -0.5,
                    x1: 3.5,
                    y0: 3, // p = 0.001
                    y1: 3,
                    line: { color: '#e74c3c', width: 2, dash: 'dash' }
                }],
                annotations: [{
                    x: 1.5,
                    y: 3.2,
                    text: 'Significance Threshold (p<0.001)',
                    showarrow: false,
                    font: { color: '#e74c3c', size: 10 }
                }],
                margin: { l: 60, r: 20, b: 60, t: 20 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };

            Plotly.newPlot('validation-results', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createPipelineFlow() {
            const trace = {
                type: "sankey",
                orientation: "h",
                node: {
                    pad: 15,
                    thickness: 30,
                    line: { color: "#2c3e50", width: 2 },
                    label: ["Raw Accelerometer", "Preprocessing", "Entropy Calculation", "Feature Engineering", 
                           "Statistical Validation", "Model Training", "Activity Classification", "Vertical Optimization"],
                    color: ["#3498db", "#2ecc71", "#e74c3c", "#f39c12", "#9b59b6", "#1abc9c", "#34495e", "#e67e22"]
                },
                link: {
                    source: [0, 1, 2, 3, 4, 5, 6, 2],
                    target: [1, 2, 3, 4, 5, 6, 7, 7],
                    value: [100, 100, 100, 100, 85, 75, 65, 28],
                    color: ["rgba(52,152,219,0.4)", "rgba(46,204,113,0.4)", "rgba(231,76,60,0.4)", 
                           "rgba(243,156,18,0.4)", "rgba(155,89,182,0.4)", "rgba(26,188,156,0.4)",
                           "rgba(52,73,94,0.4)", "rgba(230,126,34,0.4)"]
                }
            };

            const layout = {
                font: { size: 12, color: '#e0e0e0' },
                margin: { l: 20, r: 20, b: 20, t: 20 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };

            Plotly.newPlot('pipeline-flow', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function updateStats() {
            const filteredData = currentData.filter(d => 
                currentParams.activity === 'all' || d.activity === currentParams.activity
            );
            
            document.getElementById('sample-count').textContent = filteredData.length;
            
            // Simulate F-statistic based on parameters
            const fStat = 20 + Math.random() * 10 + 
                         (currentParams.embedding === 5 ? 5 : 0) + 
                         (currentParams.delay === 2 ? 3 : 0);
            document.getElementById('f-stat').textContent = fStat.toFixed(2);
            
            const effectSize = Math.min(0.5, fStat / 100);
            document.getElementById('effect-size').textContent = effectSize.toFixed(3);
        }

        function updateAllVisualizations() {
            create3DEntropyPlot();
            updateStats();
            // Other plots remain static for performance
        }

        // Event listeners for controls
        document.getElementById('activity-filter').addEventListener('change', function(e) {
            currentParams.activity = e.target.value;
            updateAllVisualizations();
        });

        document.getElementById('embedding-dim').addEventListener('input', function(e) {
            currentParams.embedding = parseInt(e.target.value);
            document.getElementById('dim-value').textContent = e.target.value;
            updateAllVisualizations();
        });

        document.getElementById('time-delay').addEventListener('input', function(e) {
            currentParams.delay = parseInt(e.target.value);
            document.getElementById('delay-value').textContent = e.target.value;
            updateAllVisualizations();
        });

        document.getElementById('viz-mode').addEventListener('change', function(e) {
            currentParams.mode = e.target.value;
            updateAllVisualizations();
        });

        // Initialize all visualizations
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(create3DEntropyPlot, 100);
            setTimeout(createFeatureHeatmap, 200);
            setTimeout(createParameterSurface, 300);
            setTimeout(createValidationResults, 400);
            setTimeout(createPipelineFlow, 500);
            setTimeout(updateStats, 600);
        });

        // Add interactive hover effects
        document.querySelectorAll('.viz-container').forEach(container => {
            container.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-5px)';
                this.style.transition = 'transform 0.3s ease';
            });
            
            container.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });
    </script>
</body>
</html>